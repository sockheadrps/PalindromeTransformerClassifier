<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Palindrome API Monitor</title>
    <style>
      :root {
        /* Color palette */
        --primary: #c4c9e0;
        --primary-dark: #625f66;
        --info: #17a2b8;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --light: #668db1;
        --dark: #343a40;
        --text: #495057;
        /* Spacing & sizing */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        --radius: 0.5rem;
        --shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
        /* Typography */
        --font-base: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        --line-height: 1.6;
      }

      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family: var(--font-base);
        line-height: var(--line-height);
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: var(--text);
        min-height: 100vh;
        padding: var(--space-lg);
        padding-bottom: 0;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: #fff;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        color: #fff;
        text-align: center;
        padding: var(--space-xl);
      }
      .header h1 {
        font-size: 2.5rem;
        margin-bottom: var(--space-sm);
        line-height: 1.2;
      }
      .header p {
        font-size: 1.125rem;
        opacity: 0.9;
      }

      .content {
        padding: var(--space-xl);
        padding-bottom: 10px;
        background: #a3e4e469;
      }

      .controls,
      .status-grid {
        display: grid;
        gap: var(--space-md);
        margin-bottom: var(--space-xl);
      }
      .controls {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
      .btn {
        display: inline-block;
        padding: var(--space-sm) var(--space-md);
        border: none;
        border-radius: var(--radius);
        font-size: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        cursor: pointer;
        box-shadow: var(--shadow);
        transition: transform 0.2s;
      }

      .btn-primary {
        background: var(--primary);
        color: #fff;
      }
      .btn-success {
        background: var(--success);
        color: #fff;
      }
      .btn-danger {
        background: var(--danger);
        color: #fff;
      }
      .btn-warning {
        background: var(--warning);
        color: var(--dark);
      }
      .btn-info {
        background: var(--info);
        color: #fff;
      }

      .status-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
      .status-card {
        background: var(--light);
        border-left: 4px solid var(--primary);
        border-radius: var(--radius);
        padding: var(--space-md);
        box-shadow: var(--shadow);
        transition: transform 0.2s;
        min-height: 200px;
      }
      .status-card:hover {
        transform: translateY(-2px);
      }
      .status-card.loaded {
        border-left-color: var(--success);
      }
      .status-card.overdue {
        border-left-color: var(--danger);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-sm);
      }
      .model-name {
        font-weight: bold;
        font-size: 1.125rem;
        color: var(--dark);
      }

      .status-badge {
        padding: var(--space-xs) var(--space-sm);
        border-radius: var(--radius);
        font-size: 0.75rem;
        font-weight: bold;
        text-transform: uppercase;
        color: #fff;
      }
      .status-badge.loaded {
        background: var(--success);
      }
      .status-badge.unloaded {
        background: #6c757d;
      }
      .status-badge.overdue {
        background: var(--danger);
      }

      .model-info .info-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--space-xs);
        font-size: 0.875rem;
      }
      .info-label {
        color: #6c757d;
      }
      .info-value {
        color: var(--dark);
        font-weight: 600;
      }

      .test-results-section {
        margin-top: var(--space-md);
        padding-top: var(--space-md);
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      .test-header {
        margin-bottom: var(--space-sm) !important;
      }
      .test-header .info-label {
        font-weight: bold;
        color: var(--dark);
        font-size: 1rem;
      }
      .test-accuracy {
        color: var(--success) !important;
        font-weight: bold;
      }

      .timer {
        text-align: center;
        font-size: 1rem;
        font-weight: bold;
        padding: var(--space-sm);
        border-radius: var(--radius);
        margin-top: var(--space-sm);
      }
      .timer.active {
        background: rgba(169, 245, 255, 0.281);
        color: #283841;
        border: 1px solid #1dffec7c;
      }
      .timer.overdue {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .test-section {
        background: var(--light);
        border-radius: var(--radius);
        padding: var(--space-md);
        margin-top: var(--space-xl);
      }
      .test-section h3 {
        margin-bottom: var(--space-md);
        color: var(--dark);
      }
      .test-input {
        display: flex;
        gap: var(--space-sm);
        margin-bottom: var(--space-md);
      }
      .test-input {
        display: flex;
        gap: 0;
        margin-bottom: var(--space-md);
        background-color: #d1d6d8;
        border: none;
        border-radius: 0;
        transition: all 0.2s ease;
      }
      .test-input:hover {
        background-color: #dee2e6;
        border-bottom-color: #adb5bd;
      }
      .test-input input {
        flex: 1;
        padding: var(--space-sm);
        background-color: transparent;
        border: none;
        font-size: 1rem;
        outline: none;
      }
      .test-input input:focus {
        outline: none;
      }
      .test-input:focus-within {
        background-color: #ffffff;
        border-bottom-color: var(--primary);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-input button {
        background-color: var(--dark);
        color: white;
        border: none;
        padding: var(--space-sm) var(--space-md);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border-radius: 0;
      }
      .test-input button:hover {
        background-color: #0056b3;
      }
      .test-input button:active {
        transform: translateY(0);
      }
      .test-result {
        display: none;
        padding: var(--space-md);
        border-left: 4px solid var(--primary);
        border-radius: var(--radius);
        background: #fff;
        font-size: 0.9rem;
      }
      .test-result.show {
        display: block;
      }
      .test-result.success {
        border-left-color: var(--success);
        background: #79738096;
      }
      .test-result.error {
        border-left-color: var(--danger);
        background: #ee757f77;
      }

      .loading {
        text-align: center;
        padding: var(--space-lg);
        color: #6c757d;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        padding: var(--space-md);
        border-radius: var(--radius);
        margin-bottom: var(--space-lg);
        border: 1px solid #f5c6cb;
      }
      .refresh-info {
        text-align: center;
        color: #6c757d;
        font-size: 0.875rem;
        margin-top: var(--space-lg);
      }

      @media (max-width: 768px) {
        body {
          padding: var(--space-md);
        }
        .header {
          padding: var(--space-lg);
        }
        .content {
          padding: var(--space-lg);
        }
        .test-input {
          flex-direction: column;
        }
      }

      /* Notification Style Glassmorphic */
      .glassmorphic-neo {
        margin: var(--space-md) 0;
        margin-top: 0;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .glass-content {
        background: rgba(28, 49, 78, 0.247);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-left: 4px solid #0caff0;
        border-radius: 12px;
        padding: var(--space-lg);
        padding-bottom: 0;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.05);
        position: relative;
        overflow: hidden;
        transition: all 0.2s ease;
        color: rgba(255, 255, 255, 0.95);
      }

      .glass-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.05) 0%,
          rgba(255, 255, 255, 0.02) 50%,
          rgba(255, 255, 255, 0.05) 100%
        );
        border-radius: 12px;
        pointer-events: none;
      }

      .glass-content:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .glass-header {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        margin-bottom: var(--space-md);
        position: relative;
        z-index: 1;
      }

      .glass-icon {
        font-size: 1.2rem;
        opacity: 0.8;
        margin-right: var(--space-sm);
      }

      .glass-title {
        font-size: 1rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.85rem;
      }

      .glass-text {
        font-size: 1.1rem;
        line-height: 1.2;
        color: rgba(0, 0, 0, 0.9);
        margin-bottom: var(--space-lg);
        position: relative;
        z-index: 1;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-family: Arial, Helvetica, sans-serif;
        font-size: 1rem;
        line-height: 1.7;
        color: rgba(0, 0, 0, 0.9);
        margin-bottom: var(--space-lg);
        position: relative;
        z-index: 1;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-weight: 500;
      }

      .glass-footer {
        display: flex;
        justify-content: flex-end;
        margin-top: var(--space-md);
        position: relative;
        z-index: 1;
      }

      .glass-accent {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        padding: var(--space-xs) var(--space-sm);
        font-size: 0.75rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: all 0.2s ease;
      }

      .glass-accent:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }

      .glass-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: var(--space-sm);
        margin: var(--space-md) 0;
        position: relative;
        z-index: 1;
      }

      .glass-info-item {
        background: rgba(44, 44, 44, 0.363);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: var(--space-sm);
        display: flex;
        flex-direction: column;
        gap: var(--space-xs);
        transition: all 0.2s ease;
      }

      .glass-info-item:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateY(-1px);
      }

      .info-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: rgba(223, 218, 218, 0.842);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .info-value {
        font-size: 0.9rem;
        font-weight: 500;
        color: rgba(223, 218, 218, 0.842);
        line-height: 1.4;
      }

      /* Test Results Specific Styling */
      .test-results-grid .glass-info-item {
        background: linear-gradient(
          135deg,
          rgba(52, 152, 219, 0.1) 0%,
          rgba(155, 89, 182, 0.1) 100%
        );
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(52, 152, 219, 0.2);
        border-radius: 12px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .test-results-grid .glass-info-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        width: 3px;
        background: #3498db;
        opacity: 1;
      }

      .test-results-grid .glass-info-item:hover {
        background: linear-gradient(
          135deg,
          rgba(52, 152, 219, 0.15) 0%,
          rgba(155, 89, 182, 0.15) 100%
        );
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.2);
        border-color: rgba(52, 152, 219, 0.4);
      }

      .test-results-grid .info-label {
        font-size: 0.85rem;
        font-weight: 700;
        color: rgba(255, 255, 255, 0.9);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        text-align: left;
      }

      .test-results-grid .info-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.95);
        line-height: 1.3;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        text-align: right;
        padding-right: 8px;
      }

      /* Unified dark blue styling for all item titles */
      .test-results-grid .glass-info-item .info-label {
        color: #193755;
        text-shadow: 0 1px 5px rgba(44, 62, 80, 0.3);
      }

      /* Special styling for accuracy values */
      .test-results-grid .info-value[id*='accuracy'] {
        color: #2ecc71;
        font-weight: 700;
      }

      /* Special styling for test cases */
      .test-results-grid .info-value[id='total-cases'] {
        color: rgba(255, 255, 255, 0.95);
        font-weight: 700;
      }

      /* Special styling for correct predictions */
      .test-results-grid .info-value[id='correct-predictions'] {
        color: #27ae60;
        font-weight: 700;
      }

      /* Special styling for incorrect predictions */
      .test-results-grid .info-value[id='incorrect-predictions'] {
        color: #2ecc71;
        font-weight: 700;
      }

      /* Responsive adjustments for glassmorphic */
      @media (max-width: 768px) {
        .glass-content {
          padding: var(--space-lg);
          margin: var(--space-md) 0;
        }

        .glass-header {
          flex-direction: column;
          text-align: center;
          gap: var(--space-sm);
        }

        .glass-title {
          font-size: 1.3rem;
        }

        .glass-text {
          font-size: 1rem;
        }

        .glass-info-grid {
          grid-template-columns: 1fr;
          gap: var(--space-xs);
        }

        .glass-info-item {
          padding: var(--space-xs);
        }

        .info-label {
          font-size: 0.7rem;
        }

        .info-value {
          font-size: 0.85rem;
        }

        .test-results-grid {
          grid-template-columns: 1fr !important;
          gap: var(--space-sm) !important;
        }

        .test-results-grid .glass-info-item {
          padding: 12px;
        }

        .test-results-grid .info-label {
          font-size: 0.7rem;
        }

        .test-results-grid .info-value {
          font-size: 1rem;
        }
      }

      /* Result Styling */
      .result-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin: var(--space-lg) 0;
      }

      .result-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: var(--space-lg);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.3s ease;
      }

      .result-header.palindrome {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      }

      .result-header.not-palindrome {
        background: linear-gradient(135deg, #fd7e14 100%, #a7434d 0%);
      }

      .result-header h3 {
        margin: 0;
        font-size: 1.3rem;
        font-weight: 600;
      }

      .result-badge {
        padding: var(--space-sm) var(--space-md);
        border-radius: 20px;
        font-weight: 600;
        font-size: 1rem;
        text-align: center;
        min-width: 80px;
      }

      .result-badge.palindrome {
        background: rgba(72, 187, 120, 0.9);
        color: white;
        border: 2px solid #28a745;
      }

      .result-badge.not-palindrome {
        background: rgba(172, 66, 66, 0.9);
        color: white;
        border: 2px solid #491c21;
      }

      .result-details {
        padding: var(--space-lg);
        background: #f8f9fa;
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-sm) 0;
        border-bottom: 1px solid #e9ecef;
      }

      .detail-item:last-child {
        border-bottom: none;
      }

      .detail-label {
        font-weight: 600;
        color: #495057;
        font-size: 0.95rem;
      }

      .detail-value {
        color: #212529;
        font-weight: 500;
        text-align: right;
        max-width: 60%;
        word-break: break-word;
      }

      .confidence-bar {
        position: relative;
        height: 20px;
        background: #2a3035b9;
        border-radius: 10px;
        overflow: hidden;
        min-width: 120px;
      }

      .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
        transition: width 0.8s ease;
      }

      .confidence-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: 600;
        font-size: 0.8rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      }

      /* Visualization section styling */
      .result-container > div:last-child {
        padding: var(--space-lg);
        background: white;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .result-header {
          flex-direction: column;
          gap: var(--space-sm);
          text-align: center;
        }

        .detail-item {
          flex-direction: column;
          align-items: flex-start;
          gap: var(--space-xs);
        }

        .detail-value {
          max-width: 100%;
          text-align: left;
        }

        .confidence-bar {
          min-width: 100px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="content">
        <div id="error-container"></div>

        <div id="status-container">
          <div class="loading">Loading model status...</div>
        </div>

        <div class="test-section">
          <!-- Cards Container -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
              margin-bottom: 20px;
              align-items: stretch;
            "
          >
            <!-- Model Architecture Card -->
            <div class="description glassmorphic-neo">
              <div class="glass-content">
                <div class="glass-header">
                  <span class="glass-title">Transformer Model Architecture</span>
                </div>
                <div class="glass-info-grid">
                  <div class="glass-info-item">
                    <span class="info-label">Model</span>
                    <span class="info-value">Reflection-Integrated Palindrome Model</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Architecture</span>
                    <span class="info-value">Dual-input (Text + Reflection Score)</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Performance</span>
                    <span class="info-value">Perfect accuracy on comprehensive tests</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Features</span>
                    <span class="info-value">Reflection Analysis + Real-time Visualizations</span>
                  </div>
                </div>
                <p class="glass-text">
                  This reflection-integrated palindrome detection model combines neural network text
                  processing with a custom character reflection score to achieve perfect palindrome
                  detection. The model uses a dual-input architecture that processes both text
                  encoding and reflection scores, providing comprehensive insights into symmetry
                  patterns. The reflection score measures character-by-character symmetry through
                  vector analysis, while the model provides real-time visualizations including
                  character similarity heatmaps, symmetry analysis, and detailed vector breakdowns.
                  This approach demonstrates how neural networks can be enhanced with
                  domain-specific features to achieve exceptional performance. Supports inputs of
                  1-50 characters with automatic model loading and unloading.
                </p>
                <div class="glass-footer"></div>
              </div>
            </div>

            <!-- Test Results Card -->
            <div
              class="description glassmorphic-neo"
              id="test-results-card"
              style="height: 100%; display: flex; flex-direction: column"
            >
              <div class="glass-content" style="flex: 1; display: flex; flex-direction: column">
                <div class="glass-header">
                  <span class="glass-title">Comprehensive Model Test Results</span>
                </div>
                <div
                  class="glass-info-grid test-results-grid"
                  style="
                    grid-template-columns: 1fr 1fr;
                    grid-template-rows: repeat(4, auto);
                    gap: 15px;
                    flex: 1;
                  "
                >
                  <div class="glass-info-item">
                    <span class="info-label">Overall Accuracy</span>
                    <span class="info-value" id="overall-accuracy">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Total Test Cases</span>
                    <span class="info-value" id="total-cases">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Palindrome Accuracy</span>
                    <span class="info-value" id="palindrome-accuracy">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Non-Palindrome Accuracy</span>
                    <span class="info-value" id="non-palindrome-accuracy">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Test Date</span>
                    <span class="info-value" id="test-date">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Length Range</span>
                    <span class="info-value" id="length-range">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Correct Predictions</span>
                    <span class="info-value" id="correct-predictions">-</span>
                  </div>
                  <div class="glass-info-item">
                    <span class="info-label">Incorrect Predictions</span>
                    <span class="info-value" id="incorrect-predictions">-</span>
                  </div>
                </div>
                <div class="glass-footer"></div>
              </div>
            </div>
          </div>

          <div class="test-input">
            <input
              type="text"
              id="test-input"
              placeholder="Enter text to test (e.g., 'race a car')"
            />
            <button class="btn btn-success" onclick="testPredictionWithAttention()">
              Classify Input
            </button>
          </div>
          <div id="test-result" class="test-result"></div>
        </div>

        <div class="refresh-info">
          Auto-refresh every 5 seconds • Last updated: <span id="last-updated">Never</span>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = window.location.origin;
      let refreshInterval;

      // Initialize the monitor
      document.addEventListener('DOMContentLoaded', function () {
        refreshStatus();
        loadTestResults();
        startAutoRefresh();
      });

      function startAutoRefresh() {
        refreshInterval = setInterval(refreshStatus, 5000);
      }

      function stopAutoRefresh() {
        if (refreshInterval) {
          clearInterval(refreshInterval);
        }
      }

      function showError(message) {
        const container = document.getElementById('error-container');
        container.innerHTML = `<div class="error">❌ ${message}</div>`;
      }

      function clearError() {
        document.getElementById('error-container').innerHTML = '';
      }

      function updateLastUpdated() {
        const now = new Date();
        document.getElementById('last-updated').textContent = now.toLocaleTimeString();
      }

      async function refreshStatus() {
        try {
          clearError();
          const response = await fetch(`${API_BASE}/model/current`);
          const data = await response.json();

          // Also fetch test results
          let testResults = {};
          try {
            const testResponse = await fetch(`${API_BASE}/model/test-results`);
            const testData = await testResponse.json();
            if (testData.success) {
              testResults = testData.test_results;
            }
          } catch (testError) {
            console.log('Could not fetch test results:', testError.message);
          }

          displayStatus(data, testResults);
          updateLastUpdated();
        } catch (error) {
          showError(`Failed to fetch status: ${error.message}`);
        }
      }

      function displayStatus(data, testResults = {}) {
        const container = document.getElementById('status-container');

        if (!data.currently_loaded) {
          container.innerHTML = `
                    <div class="status-grid">
                        <div class="status-card">
                            <div class="card-header">
                                <span class="model-name">No Models Loaded</span>
                                <span class="status-badge unloaded">Unloaded</span>
                            </div>
                            <div class="model-info">
                                <div class="info-row">
                                    <span class="info-label">Status:</span>
                                    <span class="info-value">All models unloaded</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
          return;
        }

        const modelCards = data.loaded_models
          .map((model) => {
            const isOverdue = model.time_until_unload === 'OVERDUE';
            const cardClass = isOverdue ? 'status-card overdue' : 'status-card loaded';
            const badgeClass = isOverdue ? 'status-badge overdue' : 'status-badge loaded';
            const timerClass = isOverdue ? 'timer overdue' : 'timer active';

            const timerText = isOverdue
              ? 'OVERDUE FOR UNLOAD'
              : `Unloads in: ${formatTime(model.seconds_until_unload)}`;

            // Get test results for this model
            const testData = testResults[model.model_key] || {};
            const hasTestData = Object.keys(testData).length > 0;

            return `
                    <div class="${cardClass}">
                        <div class="card-header">
                            <span class="model-name">${model.model_name}</span>
                            <span class="${badgeClass}">${isOverdue ? 'Overdue' : 'Loaded'}</span>
                        </div>
                        <div class="model-info">
                            <div class="info-row">
                                <span class="info-label">Length Range:</span>
                                <span class="info-value">${model.length_range}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Input Length:</span>
                                <span class="info-value">${model.input_length}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">File Size:</span>
                                <span class="info-value">${model.file_size || 'Unknown'}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Loaded At:</span>
                                <span class="info-value">${formatDateTime(model.loaded_at)}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Time Since Loaded:</span>
                                <span class="info-value">${model.time_since_loaded}</span>
                            </div>
                            ${
                              hasTestData
                                ? `
                            <div class="test-results-section">
                                <div class="info-row test-header">
                                    <span class="info-label">📊 Test Results:</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Accuracy:</span>
                                    <span class="info-value test-accuracy">${
                                      testData.accuracy || 'N/A'
                                    }</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Test Cases:</span>
                                    <span class="info-value">${testData.total_cases || 'N/A'}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Correct:</span>
                                    <span class="info-value">${
                                      testData.correct_predictions || 'N/A'
                                    }</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Precision:</span>
                                    <span class="info-value">${testData.precision || 'N/A'}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Recall:</span>
                                    <span class="info-value">${testData.recall || 'N/A'}</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">F1-Score:</span>
                                    <span class="info-value">${testData.f1_score || 'N/A'}</span>
                                </div>
                            </div>
                            `
                                : ''
                            }
                        </div>
                        <div class="${timerClass}">
                            ${timerText}
                        </div>
                    </div>
                `;
          })
          .join('');

        container.innerHTML = `
                <div class="status-grid">
                    ${modelCards}
                </div>
            `;

        // Display test results if available
        displayTestResults(testResults);
      }

      async function loadTestResults() {
        try {
          const testResponse = await fetch(`${API_BASE}/model/test-results`);
          const testData = await testResponse.json();
          if (testData.success) {
            displayTestResults(testData.test_results);
          } else {
            console.log('Failed to load test results:', testData.message);
            displayTestResults({});
          }
        } catch (error) {
          console.log('Error loading test results:', error.message);
          displayTestResults({});
        }
      }

      function displayTestResults(testResults) {
        const testResultsCard = document.getElementById('test-results-card');

        if (!testResults || Object.keys(testResults).length === 0) {
          // Show placeholder data if no test results available
          document.getElementById('overall-accuracy').textContent = 'No data';
          document.getElementById('total-cases').textContent = 'No data';
          document.getElementById('palindrome-accuracy').textContent = 'No data';
          document.getElementById('non-palindrome-accuracy').textContent = 'No data';
          document.getElementById('test-date').textContent = 'No data';
          document.getElementById('length-range').textContent = 'No data';
          document.getElementById('correct-predictions').textContent = 'No data';
          document.getElementById('incorrect-predictions').textContent = 'No data';
          return;
        }

        // Check if we have overall stats (new format)
        console.log('Displaying test results:', testResults);
        if (testResults.overall_stats) {
          const stats = testResults.overall_stats;
          const testInfo = testResults.test_info;

          document.getElementById('overall-accuracy').textContent = `${(
            stats.accuracy * 100
          ).toFixed(1)}%`;
          document.getElementById('total-cases').textContent =
            stats.total_correct + stats.total_incorrect;
          document.getElementById('palindrome-accuracy').textContent = `${(
            stats.palindrome_accuracy * 100
          ).toFixed(1)}%`;
          document.getElementById('non-palindrome-accuracy').textContent = `${(
            stats.non_palindrome_accuracy * 100
          ).toFixed(1)}%`;
          document.getElementById('test-date').textContent = testInfo.test_date
            ? new Date(testInfo.test_date).toLocaleDateString()
            : 'N/A';
          document.getElementById('length-range').textContent = testInfo.length_range || 'N/A';
          document.getElementById('correct-predictions').textContent = stats.total_correct;
          document.getElementById('incorrect-predictions').textContent = stats.total_incorrect;
        } else {
          // Show placeholder data if no valid test data
          document.getElementById('overall-accuracy').textContent = 'No data';
          document.getElementById('total-cases').textContent = 'No data';
          document.getElementById('palindrome-accuracy').textContent = 'No data';
          document.getElementById('non-palindrome-accuracy').textContent = 'No data';
          document.getElementById('test-date').textContent = 'No data';
          document.getElementById('length-range').textContent = 'No data';
          document.getElementById('correct-predictions').textContent = 'No data';
          document.getElementById('incorrect-predictions').textContent = 'No data';
        }
      }

      function formatTime(seconds) {
        if (seconds <= 0) return '0s';

        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;

        if (minutes > 0) {
          return `${minutes}m ${remainingSeconds}s`;
        } else {
          return `${remainingSeconds}s`;
        }
      }

      function formatDateTime(isoString) {
        const date = new Date(isoString);
        return date.toLocaleTimeString();
      }

      async function loadAllModels() {
        try {
          const response = await fetch(`${API_BASE}/model/load/all`, { method: 'POST' });
          const data = await response.json();

          if (data.success) {
            showError(`✅ ${data.message}`);
            setTimeout(refreshStatus, 1000);
          } else {
            showError(`❌ Failed to load models: ${data.error}`);
          }
        } catch (error) {
          showError(`Failed to load models: ${error.message}`);
        }
      }

      async function unloadAllModels() {
        try {
          const response = await fetch(`${API_BASE}/model/unload/all`, { method: 'POST' });
          const data = await response.json();

          if (data.success) {
            showError(`✅ ${data.message}`);
            setTimeout(refreshStatus, 1000);
          } else {
            showError(`❌ Failed to unload models: ${data.error}`);
          }
        } catch (error) {
          showError(`Failed to unload models: ${error.message}`);
        }
      }

      async function cleanupModels() {
        try {
          const response = await fetch(`${API_BASE}/model/cleanup`, { method: 'POST' });
          const data = await response.json();

          if (data.success) {
            showError(`✅ ${data.message}`);
            setTimeout(refreshStatus, 1000);
          } else {
            showError(`❌ Failed to cleanup models: ${data.error}`);
          }
        } catch (error) {
          showError(`Failed to cleanup models: ${error.message}`);
        }
      }

      async function checkHealth() {
        try {
          const response = await fetch(`${API_BASE}/health`);
          const data = await response.json();

          showError(
            `✅ Health Check: ${data.message} (${data.loaded_models}/${data.total_models} models loaded)`
          );
        } catch (error) {
          showError(`Health check failed: ${error.message}`);
        }
      }

      async function testPrediction() {
        const input = document.getElementById('test-input').value.trim();
        const resultDiv = document.getElementById('test-result');

        if (!input) {
          resultDiv.innerHTML = 'Please enter some text to test.';
          resultDiv.className = 'test-result show error';
          return;
        }

        try {
          resultDiv.innerHTML = 'Testing...';
          resultDiv.className = 'test-result show';

          const response = await fetch(`${API_BASE}/predict`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ text: input }),
          });

          const data = await response.json();

          if (response.ok) {
            const isPalindrome = data.is_palindrome ? '✅ YES' : '❌ NO';
            const visuals = data.visual_representations || {};

            let visualHtml = '';

            // Model selection visual
            if (visuals.model_selection) {
              const sel = visuals.model_selection;
              visualHtml += `
                <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                  <strong>🎯 Model Selection:</strong><br>
                  ${sel.status_icon} ${sel.status_text}<br>
                  📊 Range: ${sel.range_visualization}<br>
                  📝 Reason: ${data.selection_reason}
                </div>
              `;
            }

            // Input processing visual
            if (visuals.input_processing) {
              const proc = visuals.input_processing;
              visualHtml += `
                <div style="margin: 10px 0; padding: 10px; background: #e8f4fd; border-radius: 5px;">
                  <strong>🧹 Input Processing:</strong><br>
              `;
              proc.steps.forEach((step) => {
                visualHtml += `${step.icon} ${step.step}: "${step.text}" (${step.length} chars)<br>`;
                if (step.removed) {
                  visualHtml += `&nbsp;&nbsp;&nbsp;&nbsp;→ ${step.removed}<br>`;
                }
              });
              visualHtml += `</div>`;
            }

            // Palindrome analysis visual
            if (visuals.palindrome_analysis) {
              const pal = visuals.palindrome_analysis;
              visualHtml += `
                <div style="margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 5px;">
                  <strong>🔄 Palindrome Analysis:</strong><br>
                  📊 ${pal.confidence_bar}<br>
                  💡 ${pal.confidence_level}<br>
                  📈 Match Rate: ${pal.match_percentage}% (${pal.matches}/${pal.total_characters})
                </div>
              `;
            }

            // Performance metrics
            if (visuals.performance_metrics) {
              const perf = visuals.performance_metrics;
              visualHtml += `
                <div style="margin: 10px 0; padding: 10px; background: #d1ecf1; border-radius: 5px;">
                  <strong>⚡ Performance:</strong><br>
                  ${perf.performance_icon} ${perf.performance_level} (${perf.processing_time_ms}ms)
                </div>
              `;
            }

            resultDiv.innerHTML = `
                        <strong>Test Result:</strong><br>
                        Text: "${data.text}"<br>
                        Cleaned: "${data.cleaned_text}"<br>
                        Length: ${data.text_length} chars<br>
                        Model: ${data.model_name}<br>
                        <strong>Is Palindrome: ${isPalindrome}</strong><br>
                        Confidence: ${(data.confidence * 100).toFixed(1)}%<br>
                        ${visualHtml}
                    `;
            resultDiv.className = 'test-result show success';
          } else {
            resultDiv.innerHTML = `Error: ${data.error}`;
            resultDiv.className = 'test-result show error';
          }
        } catch (error) {
          resultDiv.innerHTML = `Failed to test: ${error.message}`;
          resultDiv.className = 'test-result show error';
        }
      }

      // Handle Enter key in test input
      document.getElementById('test-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          testPredictionWithAttention();
        }
      });

      async function testPredictionWithAttention() {
        const input = document.getElementById('test-input').value.trim();
        const resultDiv = document.getElementById('test-result');
        const button = document.querySelector('button[onclick="testPredictionWithAttention()"]');

        if (!input) {
          resultDiv.innerHTML = 'Please enter some text to test.';
          resultDiv.className = 'test-result show error';
          return;
        }

        // Start loading animation
        const originalText = button.innerHTML;
        button.innerHTML = '🔄 Processing...';
        button.disabled = true;
        button.style.opacity = '0.7';
        button.style.cursor = 'not-allowed';
        button.style.border = '2px solid transparent';
        button.style.boxShadow = '0 0 10px #667eea, 0 0 20px #667eea, 0 0 30px #667eea';
        button.style.animation = 'glow 1.5s ease-in-out infinite alternate';

        try {
          resultDiv.innerHTML = 'Testing with attention visualizations...';
          resultDiv.className = 'test-result show';

          const response = await fetch(`${API_BASE}/predict`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              text: input,
              include_reflection_analysis: true,
              include_all_visualizations: true,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            const isPalindrome = data.is_palindrome ? ' YES' : ' NO';
            let visualHtml = '';

            // Reflection Analysis
            if (data.reflection_analysis) {
              const reflection = data.reflection_analysis;
              if ('error' in reflection) {
                visualHtml += `
                  <div style="margin: 10px 0; padding: 10px; background: #f8d7da; border-radius: 5px;">
                    <strong>🔄 Reflection Analysis:</strong><br>
                    ❌ Error: ${reflection.error}
                  </div>
                `;
              } else {
                const scorePercent = (reflection.reflection_score * 100).toFixed(1);
                const scoreColor =
                  reflection.reflection_score > 0.8
                    ? '#28a745'
                    : reflection.reflection_score > 0.6
                    ? '#ffc107'
                    : '#dc3545';

                visualHtml += `
                  <div style="margin: 10px 0; padding: 15px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid ${scoreColor};">
                    <strong style="font-size: 1.1em;">🔬 Comprehensive Analysis & Classification</strong><br>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                                              <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                          <strong style="color: ${scoreColor};">Classification Result:</strong><br>
                          <span style="font-size: 1.2em; font-weight: bold; color: ${scoreColor};">${
                  data.is_palindrome ? 'YES' : 'NO'
                }</span><br>
                          <strong>Confidence:</strong><br>
                          <div style="margin: 8px 0; background: #f0f0f0; border-radius: 4px; height: 20px; position: relative; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #28a745, #20c997); height: 100%; width: ${(
                              data.confidence * 100
                            ).toFixed(1)}%; border-radius: 4px;"></div>
                            <span style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #333; font-weight: bold; font-size: 0.9em;">${(
                              data.confidence * 100
                            ).toFixed(1)}%</span>
                          </div>
                          <strong>Model:</strong> ${data.model_name}<br>
                          <div style="margin-top: 8px; padding: 5px; background: #f8f9fa; border-radius: 4px; font-size: 0.9em;">
                            💡 AI-powered palindrome detection
                          </div>
                        </div>
                      <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <strong style="color: ${scoreColor};">Reflection Score:</strong> ${scorePercent}%<br>
                        <strong>Interpretation:</strong> ${reflection.score_interpretation}<br>
                        <div style="margin-top: 8px; padding: 5px; background: #f8f9fa; border-radius: 4px; font-size: 0.9em;">
                          💡 This measures character-by-character symmetry
                        </div>
                      </div>
                      <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <strong>Text Analysis:</strong><br>
                        📝 Original: "${data.text}"<br>
                        🧹 Cleaned: "${data.cleaned_text}"<br>
                        📏 Length: ${data.text_length} characters<br>
                        🔤 Unique: ${reflection.character_analysis.unique_characters}<br>
                        ${
                          reflection.character_analysis.most_common
                            ? `⭐ Most Common: "${reflection.character_analysis.most_common}"`
                            : ''
                        }
                      </div>
                      <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <strong>Symmetry Details:</strong><br>
                        🔷 Left Half: "${reflection.symmetry_details.left_half}"<br>
                        🔶 Right Half: "${reflection.symmetry_details.right_half}"<br>
                        🔄 Reversed Right: "${reflection.symmetry_details.right_reversed}"<br>
                        ${
                          reflection.symmetry_details.center_character
                            ? `🎯 Center: "${reflection.symmetry_details.center_character}"`
                            : ''
                        }
                      </div>
                      ${
                        reflection.vector_analysis
                          ? `<div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 15px; grid-column: 1 / -1; max-height: 400px; overflow-y: auto;">
                              <strong>🔬 Vector Analysis:</strong><br>
                              <div style="font-family: monospace; font-size: 0.9em; margin-top: 12px; line-height: 1.6;">
                                <div style="margin-bottom: 10px;">
                                  <strong>Normalization:</strong> ${
                                    reflection.vector_analysis.normalization_formula
                                  }
                                </div>
                                <div style="margin-bottom: 10px;">
                                  <strong>Score Formula:</strong> ${
                                    reflection.vector_analysis.score_formula
                                  }
                                </div>
                                <div style="margin-bottom: 10px;">
                                  <strong>Mean Abs Difference:</strong> ${reflection.vector_analysis.mean_abs_difference.toFixed(
                                    4
                                  )}
                                </div>
                                                                                                <div style="margin-bottom: 15px;">
                                  <strong>📊 Left Vector:</strong><br>
                                  <div style="background: #e8f5e8; padding: 10px; border-radius: 6px; margin-top: 6px;">
                                    <div style="margin-bottom: 8px; font-family: monospace; font-size: 1.1em;">
                                      <span style="text-decoration: underline; text-decoration-color: #28a745; text-decoration-thickness: 3px;">${
                                        reflection.symmetry_details.left_half
                                      }</span><span style="color: #6c757d;">${
                              reflection.symmetry_details.center_character || ''
                            }</span><span style="color: #6c757d;">${
                              reflection.symmetry_details.right_half
                            }</span>
                                    </div>
                                    ${reflection.vector_analysis.left_mapping
                                      .map(
                                        (item, index) =>
                                          `<span style="display: inline-block; margin: 2px 4px; padding: 4px 8px; background: white; border-radius: 4px; border: 1px solid #ddd;">
                                        <strong style="color: #28a745;">${item.char}</strong><br>
                                        <small>raw: ${item.raw_value}</small><br>
                                        <small>norm: ${item.value.toFixed(3)}</small>
                                      </span>`
                                      )
                                      .join('')}
                                  </div>
                                </div>
                                <div style="margin-bottom: 15px;">
                                  <strong>📊 Right Vector (reversed):</strong><br>
                                  <div style="background: #fff3cd; padding: 10px; border-radius: 6px; margin-top: 6px;">
                                    <div style="margin-bottom: 8px; font-family: monospace; font-size: 1.1em;">
                                      <span style="color: #6c757d;">${
                                        reflection.symmetry_details.left_half
                                      }</span><span style="color: #6c757d;">${
                              reflection.symmetry_details.center_character || ''
                            }</span><span style="text-decoration: underline; text-decoration-color: #ffc107; text-decoration-thickness: 3px;">${
                              reflection.symmetry_details.right_half
                            }</span>
                                    </div>
                                    ${reflection.vector_analysis.right_mapping
                                      .map(
                                        (item, index) =>
                                          `<span style="display: inline-block; margin: 2px 4px; padding: 4px 8px; background: white; border-radius: 4px; border: 1px solid #ddd;">
                                        <strong style="color: #ffc107;">${item.char}</strong><br>
                                        <small>raw: ${item.raw_value}</small><br>
                                        <small>norm: ${item.value.toFixed(3)}</small>
                                      </span>`
                                      )
                                      .join('')}
                                  </div>
                                </div>
                                <div style="margin-bottom: 15px;">
                                  <strong>📊 Normalization of vector differences:</strong><br>
                                  <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-top: 6px;">
                                    ${reflection.vector_analysis.difference_mapping
                                      .map((item, index) => {
                                        const matchColor =
                                          Math.abs(item.difference) < 0.001 ? '#28a745' : '#dc3545';
                                        const matchIcon =
                                          Math.abs(item.difference) < 0.001 ? '✅' : '❌';
                                        return `<span style="display: inline-block; margin: 2px 4px; padding: 6px 8px; background: white; border-radius: 4px; border: 2px solid ${matchColor};">
                                        ${matchIcon} <strong style="color: #28a745;">${
                                          item.left_char
                                        }</strong> vs <strong style="color: #ffc107;">${
                                          item.right_char
                                        }</strong><br>
                                        <small>diff = ${item.difference.toFixed(3)}</small>
                                      </span>`;
                                      })
                                      .join('')}
                                  </div>
                                </div>
                              </div>
                            </div>`
                          : ''
                      }
                    </div>
                  </div>
                `;
              }
            }

            // Comprehensive Visualizations
            if (data.comprehensive_visualizations) {
              const comp = data.comprehensive_visualizations;
              if ('error' in comp) {
                visualHtml += `
                  <div style="margin: 10px 0; padding: 10px; background: #f8d7da; border-radius: 5px;">
                    <strong>📊 Comprehensive Visualizations:</strong><br>
                    ❌ Error: ${comp.error}
                  </div>
                `;
              } else if (comp.files && comp.files.length > 0) {
                visualHtml += `
                  <div style="margin: 10px 0; padding: 15px; background: #e8f5e8; border-radius: 8px; text-align: center;">
                    <strong>📊 Visualizations Generated Successfully!</strong><br>
                    <button onclick="openVisualizationsModal(['${comp.files.join("','")}'])" 
                            style="margin-top: 10px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em;">
                      🔍 View Visualizations
                    </button>
                  </div>
                `;
              }
            }

            resultDiv.innerHTML = `
                <div class="result-container">
                    <div class="result-header ${
                      data.is_palindrome ? 'palindrome' : 'not-palindrome'
                    }">
                        <h3>Classification Result</h3>
                        <div class="result-badge ${
                          data.is_palindrome ? 'palindrome' : 'not-palindrome'
                        }">
                            ${isPalindrome}
                        </div>
                    </div>
                    
                    
                    
                    ${visualHtml}
                </div>
            `;
            resultDiv.className = 'test-result show success';
          } else {
            resultDiv.innerHTML = `Error: ${data.error}`;
            resultDiv.className = 'test-result show error';
          }
        } catch (error) {
          resultDiv.innerHTML = `Failed to test: ${error.message}`;
          resultDiv.className = 'test-result show error';
        } finally {
          // Restore button to normal state
          button.innerHTML = originalText;
          button.disabled = false;
          button.style.opacity = '1';
          button.style.cursor = 'pointer';
          button.style.border = '';
          button.style.boxShadow = '';
          button.style.animation = '';
        }
      }

      // Visualization Modal Functions
      function openVisualizationsModal(filenames) {
        const modal = document.getElementById('visualizationModal');
        const content = document.getElementById('modalContent');

        let modalHtml = '';
        filenames.forEach((filename, index) => {
          modalHtml += `
            <div style="margin-bottom: 30px;">
              <h3 style="margin-bottom: 15px; color: #495057;">Visualization ${index + 1}</h3>
              <img src="/visualizations/${filename}" 
                   style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);" 
                   alt="Input Analysis Visualization"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
              <div style="display: none; padding: 15px; background: #f8d7da; border-radius: 8px; margin-top: 10px;">
                <strong>⚠️ Visualization not available:</strong> ${filename}<br>
                <small>Image may still be generating or there was an error.</small>
              </div>
            </div>
          `;
        });

        content.innerHTML = modalHtml;
        modal.style.display = 'block';
      }

      function closeVisualizationsModal() {
        document.getElementById('visualizationModal').style.display = 'none';
      }

      // Close modal when clicking outside of it
      window.onclick = function (event) {
        const modal = document.getElementById('visualizationModal');
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      };
    </script>

    <!-- Visualization Modal -->
    <div
      id="visualizationModal"
      style="
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
      "
    >
      <div
        style="
          position: relative;
          width: 95%;
          height: 95%;
          margin: 2.5% auto;
          background: white;
          border-radius: 10px;
          padding: 20px;
          overflow: auto;
        "
      >
        <span
          onclick="closeVisualizationsModal()"
          style="
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
          "
          >&times;</span
        >
        <h2 style="margin-bottom: 20px; text-align: center">📊 Input Analysis Visualizations</h2>
        <div id="modalContent" style="text-align: center">
          <!-- Modal content will be populated here -->
        </div>
      </div>
    </div>
  </body>
</html>
